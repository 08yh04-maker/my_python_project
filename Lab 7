import sqlite3
import csv

# Создание БД и нескольких таблиц
def create_tables():
    conn = sqlite3.connect('company.db')
    cur = conn.cursor()
    
    # Таблица departments
    cur.execute('''
        CREATE TABLE IF NOT EXISTS departments (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            name TEXT NOT NULL,
            budget REAL
        )
    ''')
    
    # Таблица employees
    cur.execute('''
        CREATE TABLE IF NOT EXISTS employees (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            name TEXT NOT NULL,
            position TEXT,
            salary REAL,
            department_id INTEGER,
            FOREIGN KEY (department_id) REFERENCES departments (id)
        )
    ''')
    
    conn.commit()
    conn.close()
    print("Таблицы созданы успешно!")

# Вставка данных в таблицы
def insert_data():
    conn = sqlite3.connect('company.db')
    cur = conn.cursor()
    
    # Вставка данных в departments
    departments = [
        ('IT', 50000),
        ('HR', 30000),
        ('Finance', 40000),
        ('Marketing', 35000)
    ]
    
    cur.executemany('INSERT INTO departments (name, budget) VALUES (?, ?)', departments)
    
    # Вставка данных в employees
    employees = [
        ('Иван Петров', 'Разработчик', 80000, 1),
        ('Мария Сидорова', 'Менеджер по персоналу', 50000, 2),
        ('Алексей Козлов', 'Бухгалтер', 60000, 3),
        ('Елена Новикова', 'Маркетолог', 55000, 4),
        ('Дмитрий Волков', 'Старший разработчик', 100000, 1)
    ]
    
    cur.executemany('''
        INSERT INTO employees (name, position, salary, department_id) 
        VALUES (?, ?, ?, ?)
    ''', employees)
    
    conn.commit()
    conn.close()
    print("Данные вставлены успешно!")

# Обновление записи
def update_employee():
    conn = sqlite3.connect('company.db')
    cur = conn.cursor()
    
    # Повышение зарплаты разработчикам
    cur.execute('''
        UPDATE employees 
        SET salary = salary * 1.1 
        WHERE position LIKE '%разработчик%'
    ''')
    
    # Обновление конкретного сотрудника
    cur.execute('''
        UPDATE employees 
        SET position = 'Ведущий маркетолог', salary = 60000 
        WHERE name = 'Елена Новикова'
    ''')
    
    conn.commit()
    conn.close()
    print("Записи обновлены успешно!")

# Проверка результатов
def check_results():
    conn = sqlite3.connect('company.db')
    cur = conn.cursor()
    
    print("\n--- Все сотрудники ---")
    cur.execute('''
        SELECT e.name, e.position, e.salary, d.name as department 
        FROM employees e 
        JOIN departments d ON e.department_id = d.id
    ''')
    
    for row in cur.fetchall():
        print(f"{row[0]} - {row[1]} - {row[2]} руб. - {row[3]}")
    
    conn.close()

# Основная функция для среднего уровня
def medium_level():
    print("=== СРЕДНИЙ УРОВЕНЬ СЛОЖНОСТИ ===")
    create_tables()
    insert_data()
    update_employee()
    check_results()
